<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Галерея</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            font-family: Arial, sans-serif;
        }
        .loading { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            color: white; 
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">Загрузка контента...</div>
    
    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false;"
        renderer="logarithmicDepthBuffer: true;"
    >
        <!-- Маркер с настройками -->
        <a-marker 
            type="pattern" 
            url="https://raw.githubusercontent.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/trex/trex-pattern/pat-ttrex.patt"
            emitevents="true"
            cursor="fuse: false;"
            id="marker"
        >
            <a-entity id="content-container"></a-entity>
        </a-marker>
        
        <!-- Камера с настройками -->
        <a-entity 
            camera="fov: 80; zoom: 1;"
            arjs-marker-camera
            look-controls="enabled: false"
        ></a-entity>
    </a-scene>

    <script>
        // Загружаем данные из JSON файла
        async function loadContent() {
            try {
                const response = await fetch('./data.json');
                const data = await response.json();
                return data.content;
            } catch (error) {
                console.error('Ошибка загрузки данных:', error);
                return [];
            }
        }

        // Создаем AR контент
        async function createARContent() {
            const content = await loadContent();
            const container = document.getElementById('content-container');
            
            if (content.length === 0) {
                document.getElementById('loading').innerHTML = 'Ошибка загрузки данных';
                return;
            }
            
            content.forEach((item, index) => {
                // Используем позицию из JSON или рассчитываем по умолчанию
                const position = item.position || `0 ${1.5 - (index * 1.2)} 2`;
                const scale = item.scale || '0.8 0.6 1';
                
                // Создаем плоскость с фотографией
                const photoPlane = document.createElement('a-plane');
                photoPlane.setAttribute('src', item.imageUrl);
                photoPlane.setAttribute('position', position);
                photoPlane.setAttribute('scale', scale);
                photoPlane.setAttribute('class', 'clickable');
                
                // Создаем текст под фотографией
                const textEntity = document.createElement('a-text');
                textEntity.setAttribute('value', `${item.title}\n${item.description}`);
                
                // Позиция текста - под фотографией
                const posArray = position.split(' ').map(Number);
                const textPosition = `${posArray[0]} ${posArray[1] - 0.6} ${posArray[2]}`;
                
                textEntity.setAttribute('position', textPosition);
                textEntity.setAttribute('align', 'center');
                textEntity.setAttribute('color', '#FFFFFF');
                textEntity.setAttribute('width', '2');
                textEntity.setAttribute('wrap-count', '15');
                
                container.appendChild(photoPlane);
                container.appendChild(textEntity);
            });
            
            // Скрываем индикатор загрузки
            document.getElementById('loading').style.display = 'none';
        }

        // Ждем загрузки A-Frame
        document.addEventListener('DOMContentLoaded', function() {
            const scene = document.querySelector('a-scene');
            
            scene.addEventListener('loaded', function() {
                createARContent();
            });
        });

        // Дополнительно: обработка изменения размера окна
        window.addEventListener('resize', function() {
            const camera = document.querySelector('[camera]');
            if (camera) {
                camera.components.camera.camera.aspect = window.innerWidth / window.innerHeight;
                camera.components.camera.camera.updateProjectionMatrix();
            }
        });
    </script>
</body>
</html>
